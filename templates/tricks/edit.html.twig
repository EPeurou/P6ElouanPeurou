{# {% extends 'base.html.twig' %}

{% block title %}Edit Tricks{% endblock %}

{% block body %}
    <h1>Edit Tricks</h1>

    {{ include('tricks/_form.html.twig', {'button_label': 'Update'}) }}

    <a href="{{ path('tricks_index') }}">back to list</a>

    {{ include('tricks/_delete_form.html.twig') }}
{% endblock %} #}

<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>SnowTricks</title>
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://use.fontawesome.com/releases/v5.15.3/js/all.js" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css?family=Varela+Round" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet" />
    <link href="../../css/styles.css" rel="stylesheet" />
    <link href="../../css/standard.css" rel="stylesheet" />
</head>
    <body id="page-top">
        <script>
        $( document ).ready(function() {
            if(window.matchMedia("(max-width: 450px)").matches){
                
                $(".link-add").html('<i class="fas fa-2x fa-pen-square"></i>')
                $(".link-logout").html('<i class="fas fa-2x fa-door-open"></i>')
                $(".link-login").html('<i class="fas fa-2x fa-sign-out-alt"></i>')
                $(".link-register").html('<i class="fas fa-2x fa-user-check"></i>')
                $(".link-home").html('<i class="fas fa-2x fa-home"></i>')
                $(".remove-title-nav" ).addClass( "d-none" );
                $(".navbar" ).removeClass( "fixed-top" );
                $(".navbar" ).addClass( "fixed-bottom" );
                $(".row-show").removeAttr("style");
                $(".icon-show").css("left","85%");
                $(".row-card" ).addClass( "d-none" );
                $(".btn-media" ).removeClass( "d-none" );
                $(".row-media" ).removeClass( "d-none" );
                $(".section-form" ).removeClass( "form-edit" );
                $(".container-show").css("margin-top","0em");
                $(".main-img-show").css("object-fit","cover");
                $(".row-valide").removeAttr("style");
                $(".col-valide").css("margin-right","2em");

            } else if(window.matchMedia("(max-width: 800px)").matches){
                $(".container-show").css("margin-top","0em");
                $(".link-add").html('<i class="fas fa-2x fa-pen-square"></i>')
                $(".link-logout").html('<i class="fas fa-2x fa-door-open"></i>')
                $(".link-login").html('<i class="fas fa-2x fa-sign-out-alt"></i>')
                $(".link-register").html('<i class="fas fa-2x fa-user-check"></i>')
                $(".link-home").html('<i class="fas fa-2x fa-home"></i>')
                $(".remove-title-nav" ).addClass( "d-none" );
                $(".row-nav").css("margin-left","16em");
                $(".navbar" ).removeClass( "fixed-top" );
                $(".navbar" ).addClass( "fixed-bottom" );
                $(".row-show").removeAttr("style");
                $(".icon-show").css("left","85%");
                $(".row-card" ).addClass( "d-none" );
                $(".btn-media" ).removeClass( "d-none" );
                $(".row-media" ).removeClass( "d-none" );
                $(".section-form" ).removeClass( "form-edit" );
                $(".container-show").css("margin-top","0em");
                $(".main-img-show").css("object-fit","cover");
                $(".row-valide").removeAttr("style");
                $(".col-valide").css("margin-right","2em");
                $(".row-media").css("margin-left","5em");
                $(".col-valide" ).addClass( "offset-3" );
                
            }
        });
    </script>
        {% block navbar %}
            {% include "navbar.html.twig" %}
        {% endblock %}
        <!-- Masthead-->
        {{ form_start(form) }}
        <header>
            <div class="container-show">
                {# {% set break = false %}
                {% for key,value in trick.media %}
                    {% if break == false %} #}
                        {# {% if trick.mainImage != null %}
                            <img class="main-img-show" src="{{ asset('upload/' ~ trick.mainImage[0])}}" class="card-img-top" alt="..." >
                        {% else  %} #}
                            {% if trick.mainImage != null %}
                                <img class="main-img-show" src="{{ asset('upload/' ~ trick.mainImage[0])}}" class="card-img-top" alt="..."  >
                            {% else %}
                                <img class="main-img-show" src="{{ asset('assets/img/frontflip.jpg')}}" class="card-img-top" alt="..."  >
                            {% endif %}
                        {# {% endif %} #}
                    {# {% endif %}
                    {% set break = true %}
                {% endfor %} #}
                <div>
                    <div class="icon-show text-switch">
                        {% if trick.mainImage != null %}
                            <a href="" class="del-main-img" data-bs-toggle="modal" data-bs-target="#mainImageModalDel" style="margin-left:1em;color:white;"><i class="fas fa-trash-alt"></i></a>
                        {% endif %}
                        <a href="" data-bs-toggle="modal" data-bs-target="#mainImageModal"  style="margin-right:1em;margin-left:1em;color:white;"><i class="fas fa-pencil-alt"></i></a>
                    </div>
                    <div class="centered-show">
                        <h1 class="mx-auto my-0 text-uppercase text-switch">{{ trick.name }}</h1>
                    </div>
                </div>
            </div>
        </header>
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Remplacer un media</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        {{ form_row(form.media) }}
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="ok-btn btn btn-secondary" data-bs-dismiss="modal">Ok</button>
                        <input type="hidden" id="inputHidden1">
                        <input type="hidden" id="inputHidden2">
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="mainImageModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Remplacer l'image principale</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        {{ form_row(form.mainImage) }}
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="ok-main btn btn-secondary" data-bs-dismiss="modal">Ok</button>
                    </div>
                </div>
            </div> 
        </div>
        <div class="modal fade" id="mainImageModalDel" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <i class="fas fa-2x fa-exclamation-triangle"></i><h5>Souhaitez vous vraiment supprimer l'image principale?</h5>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="ok-del-main-img btn btn-secondary" data-bs-dismiss="modal">Oui</button>
                    </div>
                </div>
            </div> 
        </div>
        <!-- About-->
        <section class=" mt-5" id="tricks">
            <div class="container px-4 px-lg-5">
                <div style="overflow: auto !important">
                    <div class="row-spe row-media d-none mb-5">
                        <div class="offset-3 col-6">
                            <a class="btn-media btn btn-primary d-none">Voir les médias</a>
                        </div>
                    </div>
                    <div class="row-show row-card mb-4 mb-lg-5 align-items-center horizontal-scrollable">
                        {% for key,value in trick.media %}
                            <div class="modal fade" id="secondModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="exampleModalLabel">Supprimer un media</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <h5 class="modal-title" id="exampleModalLabel">Souhaitez vous vraiment supprimer ce media?</h5>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" id="yes" class="yes-btn btn btn-secondary" data-bs-dismiss="modal">Oui</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-12 col-md-4 col-xl-2 mr-2 mycol">
                                <div class="card" style="width:12rem;border:none;">
                                    <div style="margin-right:1em;">
                                        {% if 'image' in value %}
                                            <img class="card-img-top" src="{{ asset('upload/' ~ value)}}" class="card-img-top" alt="..." style="width:11.9em;height:8em;">
                                        {% elseif 'video' in value %}
                                            <video controls class="card-img-top" style="width:11.9em;height:9.3em;padding:0em;margin-top:2em !important;"><source src="{{ asset('upload/' ~ value)}}"></video>
                                        {% endif %}
                                    </div>
                                    <div class="icon-media text-switch mt-2">
                                        <a href="" id="del" class="delete-media-btn" style="margin-left:1em;color:white;" data-img-val="{{value}}" data-bs-toggle="modal" data-bs-target="#secondModal"><i class="fas fa-trash-alt"></i></a>
                                        <a href="" id="0" class="edit-media-btn" data-trick-id="{{ trick.id }}" data-img-val="{{value}}" data-bs-toggle="modal" data-bs-target="#exampleModal" style="margin-right:1em;margin-left:1em;color:white;"><i class="fas fa-pencil-alt"></i></a>
                                    </div>
                                </div>
                            </div>
                            {# {% set testclick = false %}
                            {% if testclick == false %} #}
                                {# {% set currentMedia = value %} #}
                                {# <input type="text" class="currentName" value="{{value}}"> #}
                                {# {{ form_row(form.mediaName,{value: value }) }} #}
                            {# {% endif %} #}
                        {% endfor %}
                        {{ trick.embedsingle|raw }}
                    </div>
                </div>
            </div>

            {# <embed type="video/webm" src="https://www.dailymotion.com/embed/video/x1extfv" width="250" height="200">
            <embed type="video/webm" src="https://www.youtube.com/embed/_OMar04NRZw" width="250" height="200"> #}
            {# <iframe width="250" height="200" src="https://www.youtube.com/embed/_OMar04NRZw" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe> #}
        </section>
        <section class="text-center section-form form-edit">
            <h2 class="mb-4 mt-1" style="font-family:Varela Round;">Modification d'un trick</h2>
            <div class="row-spe mb-3" style="padding-left:5em;padding-right:5em;">
                <div class="col-sm-6 col-md-6 col-xl-6">
                    {{ form_row(form.name) }}
                </div>
            </div>
            <div class="row-spe" style="padding-left:5em;padding-right:5em;">
                <div class="col-sm-12 col-md-12 col-xl-12">
                    {{ form_row(form.description) }}
                </div>
            </div>
            <div class="row-spe" style="padding-left:5em;padding-right:5em;">
                <div class="col-sm-4 col-md-4 col-xl-4">
                    {{ form_row(form.category) }}
                </div>
            </div>
            <div class="row-spe" style="padding-left:5em;padding-right:5em;">
                <div class="col-sm-11 col-md-11 col-xl-11">
                    {{ form_row(form.embedsingle) }}
                </div>
                <div class="col-sm-1 col-md-1 col-xl-1 mt-4">
                    <a class="clear btn btn-primary" style="color:white;"><i class="fas fa-2x fa-trash-alt"></i></a>
                </div>
            </div>
            {# <div class="row-spe mt-3 mb-5" style="padding-left:5em;padding-right:5em;">
                <div class="col-sm-12 col-md-12 col-xl-12">
                {% for embedfield in form.embed %}
                    {{ form_row(embedfield) }}
                {% endfor %}
                </div>
            </div> #}
            <div class="row-spe row-valide mt-5" style="padding-left:5em;padding-right:5em;">
                <div class="offset-2 col-sm-4 col-md-2 col-xl-3 col-valide">
                    {{ form_row(form.valider) }}
                </div>
                {{ form_end(form) }}
                <div class="col-sm-2 col-md-5 col-xl-2">
                    <form method="post" action="{{ path('tricks_delete', {'id': trick.id}) }}" onsubmit="return confirm('Le trick va être supprimé');">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ trick.id) }}">
                        <button class="btn btn-danger">Delete</button>
                    </form>
                    {# {% block delete %} #}
                        {# {% include "_delete_form.html.twig" %} #}
                    {# {% endblock %} #}
                </div>
            </div>
        </section>

        <!-- Footer-->
        <footer class="footer bg-black small text-center text-white-50"><div class="container px-4 px-lg-5">Copyright &copy; Your Website 2021</div></footer>
        <!-- Bootstrap core JS-->
        <script>
        {# $( "#edit-media-btn" ).click(function() {
            {% set testclick = true %}
        }); #}
        $( document ).ready(function() {
            $( ".edit-media-btn" ).each(function( index ) {
                let testId = $(this).attr('id');
                if(testId == 0){
                    $(this).attr('id', index);
                } else {
                    console.log("cassé:", index);
                }
            });  
            $( ".delete-media-btn" ).each(function( index ) {
                let testIdDel = $(this).attr('id');
                if(testIdDel == "del"){
                    $(this).attr('id', "del"+index);
                } else {
                    console.log("cassé:", index);
                }
            });
            $( ".yes-btn" ).each(function( index ) {
                let testIdyes = $(this).attr('id');
                if(testIdyes == "yes"){
                    $(this).attr('id', "yes"+index);
                } else {
                    console.log("cassé:", index);
                }
            });    
        });

        $(".btn-media").click(function(){
            $(".row-card" ).removeClass( "d-none" );
            $(".row-media" ).addClass( "d-none" );
        });
        $('.clear').click(function(){
            $('#tricks_embedsingle').val('');
        });
        var testAjaxEdit = false;
        $('.edit-media-btn').click(function(){
            currentVal = undefined;
            console.log(currentVal+"first");
            var currentVal = $(this).attr('data-img-val');
            console.log(currentVal+"test");
            $('#inputHidden1').val(currentVal);
        });
        $('.ok-btn').click(function(){
            let currentVal = $('#inputHidden1').val();
                console.log(currentVal);
                fileVal = $('#tricks_media').prop('files');
                console.log(fileVal);
                if(fileVal.length > 0){
                    alert('les changements seront éffectué à la validation du formulaire');
                    if(!testAjax){
                        console.log(currentVal+"testAjax");
                        testAjax = true;
                        $.ajax({
                            url: "{{ path('ajax', {'id': trick.id}) }}",
                            type: 'POST',
                            data: {'currentVal':currentVal}, 
                            success: function(r){
                                console.log(r);
                                {# console.log(currentVal); #}
                                testAjax = false;
                            },
                            error: function(){
                                console.log('Ajax crashed');
                            }
                        });
                    }
                } else {
                    console.log("vide");
                }
            });
        $('.ok-main').click(function(){
            fileValMain = $('#tricks_mainImage').prop('files');
            console.log(fileValMain);
            if(fileValMain.length > 0){
                alert('les changements seront éffectué à la validation du formulaire');
            }
        });
        var testAjax = false;
        $('.delete-media-btn').click(function(){
            currentValDel = undefined;
            currentValDel = $(this).attr('data-img-val');
            console.log("delete click");
            $('.yes-btn').click(function(){
                {# console.log(testAjax+"first"); #}
                console.log("yes click");
                if(!testAjax){
                    testAjax = true;
                    $.ajax({
                        url: "{{ path('ajax', {'id': trick.id}) }}",
                        type: 'POST',
                        data: {'currentValDel':currentValDel}, 
                        success: function(r){
                            console.log(r);
                            console.log(currentValDel);
                            {# $('.row-show').load(window.location.href+ " .row-show" ); #}
                            location.reload();
                            testAjax = false;
                            {# console.log(testAjax); #}
                        },
                        error: function(){
                            console.log('Ajax crashed');
                        }
                    });
                }
            });
        });
        $('.ok-del-main-img ').click(function(){
            $.ajax({
                url: "{{ path('ajaxMainImage', {'id': trick.id}) }}",
                type: 'POST',
                success: function(r){
                    {# console.log(r); #}
                    location.reload();
                },
                error: function(){
                    console.log('Ajax crashed');
                }
            });
        });
            
             
        </script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        
        <!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
        <!-- * *                               SB Forms JS                               * *-->
        <!-- * * Activate your form at https://startbootstrap.com/solution/contact-forms * *-->
        <!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
        <script src="https://cdn.startbootstrap.com/sb-forms-latest.js"></script>
    </body>
</html>


